//HIPO4 library imports
import org.jlab.jnp.hipo4.io.*;
import org.jlab.jnp.hipo4.data.*;

//HipoReader object and file load
HipoReader reader = new HipoReader();
reader.open("coatjava/bin/SimOuts.hipo");

//Create event class and particle bank
SchemaFactory readerFactory = reader.getSchemaFactory();
readerFactory.show();
SchemaFactory writerFactory = readerFactory.reduce("REC::Particle");
writerFactory.show();

//Create writer object schema factory (copied from reader)
HipoWriterSorted writer = new HipoWriterSorted();
writer.getSchemaFactory().copy(readerFactory);
writer.open("coatjava/bin/SimOuts.hipo");

//Create bank objects
Bank particles = new Bank(readerFactory.getSchema("REC::Particle"));
Event     event = new Event();

//Read event from reader, get certain banks with particles we want
reader.getEvent(event,0);
  
int readCounter = 0;
int tagCounter  = 0;

while(reader.hasNext()==true){
      reader.nextEvent(event);
      event.read(particles);
      event.setEventTag(0);
      
      readCounter++;
      
      int electron = 0;
      int pos_pion = 0;
      int neg_pion = 0;
      
      if(particles.getRows()>0){
          for(int row = 0; row < particles.getRows(); row++){
              int pid = particles.getInt("pid",row);
              if(pid == 11) electron++;
              if(pid == 211) pos_pion++;
              if(pid == -211) neg_pion++;
           }
           if(electron>=1&&pos_pion>=2&&neg_pion>=2){
              tagCounter++;
              event.setEventTag(10);
           }
      }
      //Provide tag information
      writer.addEvent(event,event.getEventTag());
}
writer.close();
System.out.printf("Read events # %9d, tagged events # %9d %n",readCounter, tagCounter);
